(function(){
	var nil = $();
	$.fmx_view_loader = function(opts){
		var _self = {};
		$.extend(_self, {
			container: nil,
			req: null,
			aborted: false,
			type: 'post',
			intervals: {
				show: 600
			},
			init: function(){},
			load: function(opts){
				var _self = this;
				this._loading();
				this.req = $.ajax(
					$.extend({
						type: this.type,
						success: function(data){
							_self.success(data);
						},
						error: function(){
							_self._error();
						}
					}, opts)
				);
			},
			success: function(data){
				var _self = this;
				this.container.empty().css({
					opacity: 0
				});
				this.container.html(data);
				this._loaded();
				this.container.stop(true, false).animate({
					opacity: 1
				}, this.intervals.show, 'linear', function(){
					_self.onLoad();
				});
			},
			onLoad: function(){},
			_error: function(){
				this._loaded();
				if(this.aborted){
					this.aborted = false;
				}
				else{
					this.error();
				}
			},
			abort: function(){
				if(this.req != null){
					this.aborted = true;
					this.req.abort();
				}
			},
			_loading: function(){
				this.abort();
				this.loading();
			},
			loading: function(){},
			_loaded: function(){
				this.req = null;
				this.loaded();
			},
			loaded: function(){},
			error: function(){}
		}, opts);
		_self.init();
		return _self;
	}
})(jQuery);