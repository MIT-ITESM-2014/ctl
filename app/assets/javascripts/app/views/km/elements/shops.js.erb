(function(){
	$(function(){
		var el = app.km.elements.shops = {};
		$.extend(el, {
			parent: app.km.elements,
			data_key: 'shops_count',
			init: function(){
				var base = this.parent.getElement('shops');
				$.extend(base, this);
				$.extend(this, base);
				this.initPanel();
				this.initChart();
				this.initMap();
			},
			initMap: function(){
				$.extend(this.map, {
					addLayer: function(key, data, index){
						var layer = this.getLayer(key, data, index);
						$.extend(layer, {
							
						});
						layer.init();
					},
					addMarker: function(opts){
						var marker = this.getMarker(opts);
						$.extend(marker, {
							initMarker: function(){
								var config = this.map.config.marker;
								this.marker = new google.maps.Circle(
									$.extend({
										fillColor: this.parent.color,
										center: this.location,
										radius: this.data.f_length * config.length
									}, config.opts, this.marker_opts)
								);
							}
						});
						return marker;
					}
				});
			},
			initChart: function(){
				$.extend(this.chart, {
					render: function(){
						var data = [];
						var series = [];
						var el = {};
						$.each(this.data, function(key, val){
							data.push([val.s_type_name, val.total]);
						});
						$.extend(el, {
							type: 'pie',
							data: data
						});
						series.push(el);
						this.wrapper.highcharts(
							$.extend({
								series: series
							}, this.chart_opts)
						);
					}
				});
			},
			initPanel: function(){
				$.extend(this.panel, {
					init: function(){
						this.initContainer();
					},
					initContainer: function(){
						this.container.addClass('full');
					}
				});
				this.panel.init();
			}
		});
		el.init();
	});
})(jQuery);